#!/bin/bash
# Commit-msg hook: Validate commit message format

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

# Skip merge commits
if [[ "$commit_msg" =~ ^Merge ]]; then
    exit 0
fi

# Check for empty commit message (excluding comments)
msg_without_comments=$(echo "$commit_msg" | grep -v "^#")
if [ -z "$msg_without_comments" ]; then
    echo "ERROR: Commit message cannot be empty"
    exit 1
fi

# Warn if commit message doesn't reference an issue (but don't block)
if ! [[ "$commit_msg" =~ \#[0-9]+ ]] && ! [[ "$commit_msg" =~ issue-[0-9]+ ]]; then
    echo "WARNING: Commit message does not reference an issue (#123 or issue-123)"
    echo "Consider adding an issue reference for better traceability."
fi

exit 0
